{% extends "base.html.twig" %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('css/theme-product.css') }}" rel="stylesheet" />
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        var conditioning = [];
        {% for conditioningType in product.conditioningTypes %}
        conditioning[{{ conditioningType.id }}] = {"price": {{ conditioningType.price }}, "name": "{{ product.name }}", "conditioningTypeName": "{{ conditioningType.name }}", "conditioningTypeId": {{ conditioningType.id }} };
        {% endfor %}

        function Refresh() {
            $('#price').html(conditioning[$('#productbundle_conditioningselect_conditioning').val()]["price"] + '€');
            $('.add-item').attr("data-cost", conditioning[$('#productbundle_conditioningselect_conditioning').val()]["price"]);
            $('.add-item').attr("data-name", conditioning[$('#productbundle_conditioningselect_conditioning').val()]["name"]);
            $('.add-item').attr("data-conditioning-type-name", conditioning[$('#productbundle_conditioningselect_conditioning').val()]["conditioningTypeName"]);
            $('.add-item').attr("data-conditioning-type-id", conditioning[$('#productbundle_conditioningselect_conditioning').val()]["conditioningTypeId"]);
        }

        $('#productbundle_conditioningselect_conditioning').change(Refresh);
        Refresh();

    </script>
    <script src="{{ asset('js/item.js') }}"></script>
{% endblock %}

{% block body %}
    <div class="product-content">
        <!--Slider-->
        <div class="section-slide">
            <button class="back-button wow fadeInRight" onClick="window.history.back()">❮ {% trans %}Back to selection{% endtrans %}</button>
            <!--
            <div class="slideshow-container">
                {% for product_picture in product.pictures %}
                    <div class="mySlides">
                        <img class="photo" src="{{ asset(product_picture.url) }}" alt="{{ product_picture.alt }}"/>
                    </div>
                {% endfor %}
                <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                <a class="next" onclick="plusSlides(1)">&#10095;</a>
            </div>
            <br>
            <div style="text-align:center">
                {% for product_picture in product.pictures %}
                    <span class="dot" onclick="currentSlide({{ product_picture.id }})"></span>
                {% endfor %}
            </div>
        </td>-->
            <div id="myCarousel" class="carousel mycarousel slide" data-ride="carousel">
                <!-- Indicators -->
                <ol class="carousel-indicators mycarousel-indicators">
                    {% for key,product_picture in product.pictures %}
                        <li data-target="#myCarousel" data-slide-to="{{ key }}"{% if key==0 %} class="active"{% endif %}></li>
                    {% endfor %}
                </ol>

                <!-- Wrapper for slides -->
                <div class="carousel-inner mycarousel-inner" role="listbox">

                    {% for product_picture in product.pictures %}
                        <div class="item active">
                            <img class="photo" src="{{ asset(product_picture.url) }}" alt="{{ product_picture.alt }}"/>
                        </div>
                    {% endfor %}
                </div>

                <!-- Left and right controls -->
                <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
        <!--  TEXTE  -->
        <div class="center-justified section-presentation">
            <h3 id="TITRE" class="wow fadeInDown">{{ product.displayName }}</h3>
            <img class="wow fadeInDown" alt="lauriers" src="{{ asset('img/product/lauriers.png') }}" height="55">
            <h4 class="wow fadeInDown">{% trans %}Medal{% endtrans %}</h4>
            {% if product.averageMarks > 0 %}
                <div class="rating wow fadeInDown">
                    {% for i in range(1, product.averageMarks) %}
                        <span class="full-star">★</span>
                    {% endfor %}
                    {% if product.averageMarks < 5 %}
                        {%  for i in range(product.averageMarks + 1, 5) %}
                            <span class="empty-star">☆</span>
                        {% endfor %}
                    {% endif %}
                </div>
            {% endif %}
            <p class="wow fadeInDown">{{ product.description }} </p>
            {% if conditioning_select_form.children.conditioning is defined %}
                {{ form_start(conditioning_select_form) }}
                {{ form_widget(conditioning_select_form) }}
                {{ form_end(conditioning_select_form) }}

            <div class="countdown-container my-countdown-container">
                <span class="countdown-price h3 wow fadeInUp price-show" id="price">0.00 €</span>
                {% set picture = product.pictures|last %}
                <span class="btn btn-default add-item wow swing" {% if picture %}data-image="/{{ picture.url}}"{% endif %}
                      data-name="{{ product.name }}" data-cost="{{ product.price }}" data-id="{{ product.id }}">
            <div id="ajout"><img alt="e-commerce" src="{{ asset('img/product/panier.png') }}" height="55"></div>
            <span class="ti-shopping-cart"></span>{% trans %}Panier{% endtrans %}
            {% else %}
                <span class="h2 wow fadeInUp" >Indisponible</span>
            {% endif %}
        </span>
            </div>
        </div>
        <!--Tableau presentation-->
        <h2>Details</h2>
        <table class="presentation-table">
            <tr>
                <td class="attribute">
                    {% trans %}Universes{% endtrans %}:
                </td>
                <td class="att-value">
                    {% for universe in product.universes %} {{universe.name}} {% if not loop.last %}, {% endif %}{% endfor %}
                </td>
            </tr>
            <tr>
                <td class="attribute">
                    {% trans %}Volume{% endtrans %}:
                </td>
                <td class="att-value">
                    {{ product.volume }}L
                </td>
            </tr>
            <tr>
                <td class="attribute">
                    {% trans %}Degres Alcool{% endtrans %}:
                </td>
                <td class="att-value">
                    {{ product.alcoholDegree }}%
                </td>
            </tr>
            <tr>
                <td class="attribute">
                    {% trans %}Sucre{% endtrans %}:
                </td>
                <td class="att-value">
                    {{ product.sugar }} g/L
                </td>
            </tr>
            <tr>
                <td class="attribute">
                    {% trans %}Stock{% endtrans %}:
                </td>
                <td class="att-value">
                    {{ product.stock}} {% trans %}Bouteille{% endtrans %}{% if product.stock>1 %}s{% endif %}
                </td>
            </tr>
            {% if product.conditioningTypes is not empty  %}
                <tr>
                    <td class="td attribute">
                        {% trans %}Conditioning{% endtrans %} :
                    </td>
                    <td class="td att-value">
                        {% for conditioningType in product.conditioningTypes %}
                            {{ conditioningType.name }} (XXX {% trans %}Bouteille{% endtrans %}s){% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td class="td attribute">
                        {% trans %}Conditioning{% endtrans %} :
                    </td>
                    <td class="td att-value">
                        Produit non disponible
                    </td>
                </tr>
            {% endif %}
            {%  block features %}
            {% endblock %}
        </table>
        <!--  AVIS  -->
        <h2>Avis</h2>
        {% for evaluation in product.evaluations %}
            <div class="comment">
                <div class="comment-header">
                    <h4 class="yellow text-center">{{ evaluation.user.username }}</h4>
                    <div class="rating">
                        {% for i in range(1, evaluation.mark) %}
                            <span class="full-star">★</span>
                        {% endfor %}
                        {% if evaluation.mark < 5 %}
                            {%  for i in range(evaluation.mark + 1, 5) %}
                                <span class="empty-star">☆</span>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>

                <div class="comment-content">
                    <p>{{ evaluation.review }}</p>

                </div>
            </div>
        {% endfor %}
    </div>


    {% if utilisateur != null %}
        <h3 class="text-center">Ajouter un commentaire</h3>

        <div class="comment">
            <div class="comment-header">
                <h4 class="yellow text-center">
                    {{ utilisateur.username }}
                </h4>
                <li>
                    <div class="rating">
                        <a id="1" class="star" title="Give 1 star">☆</a>
                        <a id="2" class="star" title="Give 2 stars">☆</a>
                        <a id="3" class="star" title="Give 3 stars">☆</a>
                        <a id="4" class="star" title="Give 4 stars">☆</a>
                        <a id="5" class="star" title="Give 5 stars">☆</a>
                    </div>
                </li>
            </div>


            <div class="comment-content">
                <div class="form-style-1">
                    <ul>
                    {% for error in errors %}
                        <li>{{ error.message }}</li>
                    {% endfor %}
                    </ul>
                    {{ form_start(evaluation_form) }}
                    {{ form_widget(evaluation_form) }}
                    {{ form_end(evaluation_form) }}
                </div>
            </div>
        </div>
    {% else %}
        <h3 class="text-center">Vous de devez être connecté pour laisser un commentaire</h3>
    {% endif %}
{% endblock %}



